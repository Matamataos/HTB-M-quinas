<h1 align="center">StuxCTF</h1>

<p align="center"><img src="https://github.com/user-attachments/assets/03600f76-fbae-4571-bfff-de7b40b0938f"></p>

# INTRODUCCIÓN



TEST DE CONECTVIIDAD

![image](https://github.com/user-attachments/assets/50a93e28-4142-4726-b694-978d146acf10)

ESCANER DE PUERTOS

Con un escáner simple encontramos los famosos puertos abiertos 22-80

![image](https://github.com/user-attachments/assets/d15e0cdd-fb27-4e65-b1ef-e8d80c7f2cbb)

Nos metemos dentro de la web, cual es blanca.

![image](https://github.com/user-attachments/assets/db7b7111-bf30-4687-884c-b4412634199e)

En el código fuente encontramos un directorio secreto pero esta encriptado.

```
 The secret directory is...
		p: 9975298661930085086019708402870402191114171745913160469454315876556947370642799226714405016920875594030192024506376929926694545081888689821796050434591251;
		g: 7;
		a: 330;
		b: 450;
		g^c: 6091917800833598741530924081762225477418277010142022622731688158297759621329407070985497917078988781448889947074350694220209769840915705739528359582454617;

```


Si nos fijamos en los hints de THM nos dice como descifrarlo, creamos un pequeño script en py [script](https://github.com/d4l1v3rd3/CTF/blob/main/scripts/StuxCTF_Scriptpy_desencriptar.py)

![image](https://github.com/user-attachments/assets/de41f7fc-c727-4482-89ad-5b6aa0c44005)

Estamos dentro de la ruta

![image](https://github.com/user-attachments/assets/5748ca66-9098-4ab3-be6b-081ac725f3e4)

Si nos fijamos en el código fuente nos da otro hint : /?file=

probamos por ejemplo páginas como, admin.php, /etc/passwd, y vemos que tenemos una que funciona "index.php"

La cual nos da: 3d3d67432b384349794a47502b7757623068324c386f67507641696369786a50355232626939435067414349676f67507641696369786a5030425861794e326376776a50694d6e617534576174354363684a48647a523362764a324c7a70324c7a52585a7a4e585969307a59794e484930425861794e32633841434967414349674143494b347a4c67496e5938344464776c6d636a4e334c38346a497a706d4c756c5762754d6a4c78456a4c78305365795657647870324c7a70324c7a52585a7a4e585969307a59794e484930425861794e32633841434967414349674143494b347a4c67496e593841434967414349674143496741434967346a647052324c3841434967414349674143494b347a4c67496e5938346a647052324c38414349674143496741434967414349676f67507641696369786a507956476475563259767754434a6b51434b347a4c67496e593834544d6f39435075344364704a6d59684a48496c5258616f6448496c68476467633362737832624735544d6f7854434a6b51434a6f67507641696369786a507956476475563259386b51434a6b67432b384349794a47502b496962764a4864764a576231706d49394d336368783259675958616b784449674143496741434967414349674169432b384349794a47502b4969636c35576168526e62764e6d49394d336368783259675958616b7844496741434967414349676f67507641696369786a507430434939554762705a32507641694f303557616f42534c744543506741434967414349674169432b384349794a47502b595859753943506741434967414349674169432b384349794a47502b5958616b394350674143496741434967414349676f67507641696369786a50326c475a76774449674143496741434967414349674169432b384349794a47502b45324c3855576276686b5069414861773543656c526d62704a53506d566d636f4269496b355759794a574c79466d5932466d6269307a637a4647626a42535938414349674143496741434967414349674143494b347a4c67496e5938346a6276524864314a324c38414349674143496741434967414349674143494b347a4c67496e5938346a626842336376776a62766c47646864576132466d62675547626e64326255356a4935786d62763169637a4a53507a4e5859734e4749754647637a78444967414349674143496741434967414349674143494b347a4c67496e5938346a4979466d5932466d6269307a6373396d63303532626a315359704a58596749535a7a7857596d4a53506b56475a754647633456574c686c6d636842694979466d5932466d626a4953503056325a7946476474454764685247496955326377464762733932596930545a7364325a7652584c685258596b4269496b5632637746476273393259675547626e64326230316963684a6d6468356d49394d3363687832596749696276524864314a6d4939554763355248497539476430566e5938414349674143496741434967414349674143494b347a4c67496e5938346a497956475a6856476174495859695a5859754a53507a4e5859734e4749326c475a38414349674143496741434967414349676f67507641696369786a506949585a756c5759303532626a4a53507a4e5859734e4749326c475a384143496741434967414349674169432b384349794a47502b4943637652584c6b564765705a574c79466d5932466d626751486231466d5a6c52574c79466d5932466d6267495859695a5859754a53507a4e5859734e474932466d623841434967414349674143494b347a4c67496e59383454656b396d593841434967414349674143494b347a4c67496e593834445a6856476176774449674143494b347a4c67496e5938347a4c674979637a4e6d4c6c785765304e334c7a4e3359764d48646c4e3363684a53506d566d636f4269493056575a6f4e585a736c48647a4a535073566d6367736d62707847506741434967414349674169432b384349794a47502b384349694d33636a35696270316d4c77466d63304e486476396d59764d33636a397963305632637a466d493959575a796847496951585a6c6832636c785765304e6e493977575a79427961756c47623841434967414349674143494b347a4c67496e5938346a497830545a734632597a314362686c47647035576167774361305257613331535a6a6c6d646c5257506f52485a70646e4939516e626c526e62764e474969516e63764233646c6c6d646930545a74466d62674547646c3147506741434967414349674169432b384349794a47502b49434f74594556564a535030563263794647616a42535930565762386b67432b384349794a47502b554762306c476476776a52554e4565315233552b554762306c47643841434967414349674143494b347a4c67496e593834445a6856476138414349674169432b384349794a47502b7757623068474946425657554e3054454643504b347a4c67496e59386f67507641696369787a4f706b535a74466d6266564762705a474a6f4d486475564764753932596652585a6e39565a736c6d5a6f556d6570785759704a585a7a3557644b347a4c67496e5938306e432b384349794a4750376b534b706b534b3035575a303532626a52434973496949677779636e4647646b67535a6a46476277566d63664a48647a686963694a44627568535a6b393259755632583059545a7a466d596f59585a794a48647a6843656c686d4d756c6d59673847616a5647496741434967414349676f67507641696369787a4f704969496777694969675365684a6e6368425350674d335a6852484a6741434967414349674169432b384349794a4750376b535a74466d6266564762705a474a6f4d486475564764753932596652585a6e39565a736c6d5a673044493035575a303532626a5243496741434967414349676f67507641696369787a65704943636f426e4c3456475a756c6d493930545a74466d6266564762705a474a6f5957614b347a4c67496e59386f675076416963697854664b347a4c67496e5938736a49685133637068585267386d6267554762705a6b49673847616a5647496741434967414349676f67507641696369787a65706b535a74466d6266564762705a474a6f4d48647a6c47656c39565a736c6d5a6841694a6d41534b6c3157597539565a736c6d5a6b6743646c4e33637068695a707067507641696369787a4f6464535a736c6d5a6e734656466430586b41535067555762683532586c7857616d5269432b384349794a47504b347a4c67496e59386f675076416963697854664b347a4c67496e59383048496741434967414349676f67507641696369787a4f7045476468526d50744d58616f52484a6777535a736c6d5a2b307963706847646b6779633035575a303532626a394664314233586c7857616d42434967414349674143496741434967414349674169432b384349794a4750376c434b304e5764795233636c52325866426962766c47646a3557646d42434967414349674143494b347a4c67496e5938736a49304e585a304243637456485a69415350674547646852474a674d5761734a57647742434967414349674143494b347a4c67496e5938736a49306848647541586231526d49673044496c7857616d5243496a6c4762695648636741434967414349674169432b384349794a47503742535a736c6d5a674d3363687832594b347a4c67496e593873544b7767795a756c4764793947636c4a335879396d6379566d432b384349794a4750

Nos fijamos que si lo llevamos a un decoder, esta codificado en "hex" por lomenos la primera vez.

![image](https://github.com/user-attachments/assets/36af2ccc-5560-4d44-a513-af0892829c50)

Posteriormente, vemos que esta reversa codificado en base64
```
<br />
error_reporting(0);<br />
class file {<br />
        public $file = "dump.txt";<br />
        public $data = "dump test";<br />
        function __destruct(){<br />
                file_put_contents($this->file, $this->data);<br />
        }<br />
}<br />
<br />
<br />
$file_name = $_GET['file'];<br />
if(isset($file_name) && !file_exists($file_name)){<br />
        echo "File no Exist!";<br />
}<br />
<br />
if($file_name=="index.php"){<br />
        $content = file_get_contents($file_name);<br />
        $tags = array("", "");<br />
        echo bin2hex(strrev(base64_encode(nl2br(str_replace($tags, "", $content)))));<br />
}<br />
unserialize(file_get_contents($file_name));<br />
<br />
<!DOCTYPE html><br />
    <head><br />
        <title>StuxCTF</title><br />
	<meta charset="UTF-8"><br />
        <meta name="viewport" content="width=device-width, initial-scale=1"><br />
        <link rel="stylesheet" href="assets/css/bootstrap.min.css" /><br />
        <link rel="stylesheet" href="assets/css/style.css" /><br />
    </head><br />
        <body><br />
        <nav class="navbar navbar-default navbar-fixed-top"><br />
          <div class="container"><br />
            <div class="navbar-header"><br />
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><br />
                <span class="sr-only">Toggle navigation</span><br />
              </button><br />
              <a class="navbar-brand" href="index.php">Home</a><br />
            </div><br />
          </div><br />
        </nav><br />
        <!-- hint: /?file= --><br />
        <div class="container"><br />
            <div class="jumbotron"><br />
				<center><br />
					<h1>Follow the white rabbit..</h1><br />
				</center><br />
            </div><br />
        </div>            <br />
        <script src="assets/js/jquery-1.11.3.min.js"></script><br />
        <script src="assets/js/bootstrap.min.js"></script><br />
    </body><br />
</html><br />
```

Vemos el código fuente de index.php. primero vemos que chekea el input de /?file es index.php lo codifica y es lo que vemos, Pero todos los nombres que no sean index.php van a decir que no existe,  sin embargo vemos "unseralize" linea, esto es una vulnerabilidad del código php [información_vuln](https://notsosecure.com/remote-code-execution-php-unserialize)

Vamos a escribir un código simple de php para hacer una rev shell

![image](https://github.com/user-attachments/assets/ad0ffe11-90a4-4678-a334-11efa82cb59e)

![image](https://github.com/user-attachments/assets/02cecf4d-ab55-44c2-a265-62db4e06132f)

Creamos un servidor http para descargar el archivo

```
python3 -m htt.server
```
Posteriormente nos vamos a la ruta y seleccionamos el archivo que queremos descargar

![image](https://github.com/user-attachments/assets/95d4f7a2-d0e2-4e39-924d-2ed67ab8a6e3)

Comprobado que esta subido probamos a ejecutarlo

Estamos dentro 

![image](https://github.com/user-attachments/assets/212e1083-0730-4114-a751-8db425696642)

SACAMOS LA PRIMERA FLAG: 

![image](https://github.com/user-attachments/assets/d0c1f77f-5cbd-4532-a85d-0d137cea48b9)

Hacemos una buena shell con 

```
python3 -c 'import pty;pty.spawn("/bin/bash")'
```

![image](https://github.com/user-attachments/assets/c51f138e-740a-4900-8eda-9e3b9c13caae)

Maravilloso la escala de privilegios más fácil de mi vida.

![image](https://github.com/user-attachments/assets/5ccbc813-bab5-4a07-9b94-c8fe3faf7995)

Puede ejecutar todo sin necesidad de nada solo con sudo

![image](https://github.com/user-attachments/assets/6757b38e-4f9f-48b3-a692-50c5b7071d6f)

GG


